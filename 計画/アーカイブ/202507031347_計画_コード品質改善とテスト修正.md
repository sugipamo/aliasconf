# 計画: コード品質改善とテスト修正

作成日: 2025年7月3日 13:47

## 概要

AliasConfプロジェクトのPhase 1（安定化と検証）において、コード品質の改善とテストの修正を行う。現在、521件のコードスタイル違反と6件の失敗テストがあり、テストカバレッジは59%に留まっている。これらを改善し、プロジェクトの品質を向上させる。

## 目標

1. **コード品質改善**
   - 521件のコードスタイル違反を0件に削減
   - 型エラーをすべて解決
   - Python 3.8以降の互換性を確保

2. **テスト修正**
   - 6件の失敗テストをすべて修正
   - テストカバレッジを59%から80%以上に向上

3. **開発環境整備**
   - PYTHONPATH設定の自動化
   - 依存関係の明確化

## 作業計画

### Phase 1: 自動修正可能な問題の解決（所要時間: 30分）

1. **ruffによる自動修正**
   ```bash
   ruff check --fix src/ tests/
   ```
   - 348件の自動修正可能な違反を一括修正
   - 主な修正内容：
     - 空白行の空白文字（W293）: 478件
     - 末尾の空白（W291）: 12件
     - 未使用のインポート（F401）: 9件
     - ファイル末尾の改行（W292）: 7件

2. **修正結果の確認**
   - gitで変更内容を確認
   - テストが通ることを確認

### Phase 2: 手動修正が必要な問題の解決（所要時間: 2時間）

1. **残りのコードスタイル違反の修正**（173件）
   - 未使用の変数（F841）: 5件
   - except内でのraise（B904）: 4件
   - その他の違反

2. **型エラーの解決**
   - mypyを実行して型エラーを特定
   - Python 3.8互換性の問題を修正
   - 必要な型アノテーションを追加

### Phase 3: テストの修正（所要時間: 3時間）

1. **統合テストの修正**（4件）
   - test_base_and_override_configs
   - test_modular_configuration_structure
   - test_config_includes_pattern
   - test_multi_environment_deployment
   
   問題の原因：ファイルパスやテンプレート展開の不具合

2. **パフォーマンステストの修正**（2件）
   - test_large_config_load_time
   - test_wide_flat_structure_performance
   
   問題の原因：パフォーマンス基準が厳しすぎる、または実装の最適化不足

### Phase 4: テストカバレッジの向上（所要時間: 3時間）

1. **低カバレッジモジュールの改善**
   - core/node.py（現在51%）
   - utils/formatters.py（現在41%）
   - utils/helpers.py（現在43%）

2. **新規テストケースの追加**
   - エッジケースのテスト
   - エラーハンドリングのテスト
   - 境界値テスト

### Phase 5: 開発環境整備（所要時間: 1時間）

1. **開発用セットアップスクリプトの作成**
   - setup_dev.sh：開発環境のセットアップを自動化
   - PYTHONPATHの設定
   - 仮想環境の作成
   - 依存関係のインストール

2. **ドキュメントの更新**
   - CONTRIBUTING.mdの作成
   - 開発者向けセットアップガイド

## 優先順位

1. **最優先**: ruffによる自動修正（影響が大きく、作業が簡単）
2. **高**: 失敗テストの修正（機能の正常性に直結）
3. **中**: 手動でのコードスタイル修正
4. **中**: テストカバレッジの向上
5. **低**: 開発環境整備

## 成功基準

- [ ] ruff checkでエラーが0件
- [ ] mypy実行でエラーが0件
- [ ] すべてのテストが成功
- [ ] テストカバレッジが80%以上
- [ ] CI/CDパイプラインが正常に動作

## リスクと対策

1. **リスク**: 自動修正により既存の動作が変わる可能性
   - **対策**: 修正前後でテストを実行し、動作を確認

2. **リスク**: パフォーマンステストの基準値調整により、実際のパフォーマンス問題を見逃す
   - **対策**: 基準値は現実的な値に設定し、将来的な最適化の目標として記録

3. **リスク**: 新規テスト追加により、さらなる問題が発見される
   - **対策**: 発見された問題は優先度を付けて対応

## 次のステップ

この計画完了後は、以下の作業に移行：
1. GitHub ActionsによるCI/CDパイプラインの構築
2. PyPIへの自動リリース設定
3. Phase 2（機能拡充）の準備

---

**作成者**: Claude Code  
**承認待ち**: ユーザー確認後、実行開始